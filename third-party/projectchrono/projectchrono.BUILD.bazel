load("@rules_foreign_cc//foreign_cc:defs.bzl", "cmake")

filegroup(
    name = "all-srcs",
    srcs = glob(["**"]),
)

""" re: out_binaries, i tried to use a glob(["demo_*"]), but it found nothing.
    wasn't sure which ones i'd need and altering this list causes a full clean build,
    about 500s.
    that's why its a gigantic list"""

cmake(
    name = "projectchrono",
    cache_entries = {
        "ENABLE_MODULE_VEHICLE": "true",
        "ENABLE_MODULE_IRRLICHT": "true",
        "ENABLE_MODULE_POSTPROCESS": "true",
    },
    lib_source = ":all-srcs",
    visibility = ["//visibility:public"],
    generate_args = ["-GNinja"],
    out_data_dirs = ["share/chrono/data"],
    out_shared_libs = [
        "libChronoEngine.so",
        "libChronoEngine_irrlicht.so",
        "libChronoEngine_vehicle.so",
        "libChronoEngine_vehicle_irrlicht.so",
        "libChronoModels_robot.so",
        "libChronoModels_vehicle.so",
        "libChronoEngine_postprocess.so",
    ],
    out_bin_dir = "share/chrono/bin",    
    out_binaries = [
        "demo_CH_EulerAngles",
        "demo_CH_archive",
        "demo_CH_buildsystem",
        "demo_CH_coords",
        "demo_CH_filesystem",
        "demo_CH_functions",
        "demo_CH_linalg",
        "demo_CH_math",
        "demo_CH_matrix_ref",
        "demo_CH_powertrain",
        "demo_CH_solver",
        "demo_COSIM_data_exchange",
        "demo_COSIM_hydraulics",
        "demo_COSIM_socket",
        "demo_FEA_basic",
        "demo_FEA_cables",
        "demo_FEA_contacts_SMC",
        "demo_FEA_dynamics",
        "demo_FEA_electrostatics",
        "demo_FEA_hexaANCF_3813",
        "demo_FEA_loads_dynamics",
        "demo_FEA_loads_statics",
        "demo_FEA_shellsANCF_3423",
        "demo_FEA_shellsANCF_3833",
        "demo_FEA_thermal",
        "demo_FEA_truss",
        "demo_IRR_assets",
        "demo_IRR_decomposition",
        "demo_IRR_paths",
        "demo_IRR_visualize_FEA",
        "demo_IRR_visualize_collision",
        "demo_MBS_aux_ref",
        "demo_MBS_ballSMC",
        "demo_MBS_bricks",
        "demo_MBS_callbackNSC",
        "demo_MBS_callbackSMC",
        "demo_MBS_cohesion",
        "demo_MBS_collisionNSC",
        "demo_MBS_collisionSMC",
        "demo_MBS_collision_2d",
        "demo_MBS_collision_trimesh",
        "demo_MBS_convergence",
        "demo_MBS_conveyor",
        "demo_MBS_crank",
        "demo_MBS_custom_contact",
        "demo_MBS_earthquake",
        "demo_MBS_emit_cluster",
        "demo_MBS_emit_processor",
        "demo_MBS_emitter",
        "demo_MBS_feeder",
        "demo_MBS_forklift",
        "demo_MBS_fourbar",
        "demo_MBS_friction",
        "demo_MBS_gears",
        "demo_MBS_hydraulic_actuator",
        "demo_MBS_hydraulic_crane",
        "demo_MBS_hydraulic_crane_cosim",
        "demo_MBS_imposed_motion",
        "demo_MBS_link_bushing",
        "demo_MBS_mecanum",
        "demo_MBS_motors",
        "demo_MBS_pendulum",
        "demo_MBS_planar",
        "demo_MBS_prismatic_force",
        "demo_MBS_prismatic_limits",
        "demo_MBS_report_collisions",
        "demo_MBS_rev_limits",
        "demo_MBS_rev_reactions",
        "demo_MBS_rev_sph",
        "demo_MBS_rev_trans",
        "demo_MBS_rot_spring",
        "demo_MBS_spring",
        "demo_MBS_suspension",
        "demo_MBS_tracks",
        "demo_MBS_ujoint",
        "demo_ROBOT_Curiosity_Rigid",
        "demo_ROBOT_Curiosity_SCM",
        "demo_ROBOT_LittleHexy",
        "demo_ROBOT_RoboSimian_Rigid",
        "demo_ROBOT_RoboSimian_SCM",
        "demo_ROBOT_Turtlebot_Rigid",
        "demo_ROBOT_Viper_Rigid",
        "demo_ROBOT_Viper_SCM",
        "demo_VEH_ArticulatedVehicle",
        "demo_VEH_Controller_AIDriver",
        "demo_VEH_Controller_DLC",
        "demo_VEH_Gator_Incline",
        "demo_VEH_HMMWV9_YUP",
        "demo_VEH_HMMWV_Rollover",
        "demo_VEH_M113",
        "demo_VEH_M113_Band",
        "demo_VEH_Marder",
        "demo_VEH_RigidTerrain_MovingPatch",
        "demo_VEH_RigidTerrain_WheeledVehicle",
        "demo_VEH_SCMTerrain_RigidTire",
        "demo_VEH_SCMTerrain_TrackedVehicle",
        "demo_VEH_SCMTerrain_WheeledVehicle",
        "demo_VEH_Sedan_Lockable_Diff",
        "demo_VEH_SuspensionTestRig",
        "demo_VEH_Test_Accel",
        "demo_VEH_Test_FMTV_Ride",
        "demo_VEH_Test_ISO2631_Ride",
        "demo_VEH_Test_ISO2631_Shock",
        "demo_VEH_TireTestRig",
        "demo_VEH_TrackTestRig",
        "demo_VEH_TrackedJSON",
        "demo_VEH_TrackedJSON_Band",
        "demo_VEH_TwoCars",
        "demo_VEH_Wheeled",
        "demo_VEH_WheeledGeneric",
        "demo_VEH_WheeledGenericSet",
        "demo_VEH_WheeledJSON",
    ],
    deps = [
        "@eigen",
    ],

    copts = ["-I/usr/include/irrlicht"],
    target_compatible_with = select({
        "@platforms//os:windows": ["@platforms//:incompatible"],
        "//conditions:default": [],
    }),
)
